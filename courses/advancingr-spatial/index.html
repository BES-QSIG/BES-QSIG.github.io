<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.1.0">
  <meta name="generator" content="Hugo 0.90.0" />
  

  
  
  
  
    
  
  <meta name="description" content="Part I: Preliminaries Required packages For this &ldquo;tutorial&rdquo;, you will need some packages and their dependencies
if(!requireNamespace(&#34;raster&#34;)) install.packages(&#34;raster&#34;) if(!requireNamespace(&#34;sf&#34;)) install.packages(&#34;sf&#34;) if(!requireNamespace(&#34;ggplot2&#34;)) install.packages(&#34;ggplot2&#34;) if(!requireNamespace(&#34;ggspatial&#34;)) install.packages(&#34;ggspatial&#34;) if(!requireNamespace(&#34;rgdal&#34;)) install.packages(&#34;rgdal&#34;) if(!requireNamespace(&#34;RPostgreSQL&#34;)) install.packages(&#34;RPostgreSQL&#34;) if(!requireNamespace(&#34;rgbif&#34;)) install.packages(&#34;rgbif&#34;) library(raster) library(sf) library(ggplot2) library(ggspatial) library(RPostgreSQL) library(rgdal) library(rgbif) The data for this tutorial are available from [here](needs link).
What is a spatial object? A spatial object is an entity with coordinates in a geographical space (x, y) or (x, y, z) with a specific projection.">

  
  <link rel="alternate" hreflang="en-us" href="https://BES-QSIG.github.io/courses/advancingr-spatial/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/custom.css">
  

  
  
  

  
  <link rel="alternate" href="https://BES-QSIG.github.io/index.xml" type="application/rss+xml" title="BES QUANTITATIVE ECOLOGY GROUP">
  <link rel="feed" href="https://BES-QSIG.github.io/index.xml" type="application/rss+xml" title="BES QUANTITATIVE ECOLOGY GROUP">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="https://BES-QSIG.github.io/courses/advancingr-spatial/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@bes_qe_sig">
  <meta property="twitter:creator" content="@bes_qe_sig">
  
  <meta property="og:site_name" content="BES QUANTITATIVE ECOLOGY GROUP">
  <meta property="og:url" content="https://BES-QSIG.github.io/courses/advancingr-spatial/">
  <meta property="og:title" content="Day Two: Spatial data manipulation and visualisation in R | BES QUANTITATIVE ECOLOGY GROUP">
  <meta property="og:description" content="Part I: Preliminaries Required packages For this &ldquo;tutorial&rdquo;, you will need some packages and their dependencies
if(!requireNamespace(&#34;raster&#34;)) install.packages(&#34;raster&#34;) if(!requireNamespace(&#34;sf&#34;)) install.packages(&#34;sf&#34;) if(!requireNamespace(&#34;ggplot2&#34;)) install.packages(&#34;ggplot2&#34;) if(!requireNamespace(&#34;ggspatial&#34;)) install.packages(&#34;ggspatial&#34;) if(!requireNamespace(&#34;rgdal&#34;)) install.packages(&#34;rgdal&#34;) if(!requireNamespace(&#34;RPostgreSQL&#34;)) install.packages(&#34;RPostgreSQL&#34;) if(!requireNamespace(&#34;rgbif&#34;)) install.packages(&#34;rgbif&#34;) library(raster) library(sf) library(ggplot2) library(ggspatial) library(RPostgreSQL) library(rgdal) library(rgbif) The data for this tutorial are available from [here](needs link).
What is a spatial object? A spatial object is an entity with coordinates in a geographical space (x, y) or (x, y, z) with a specific projection.">
  
  
    
  <meta property="og:image" content="https://BES-QSIG.github.io/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-11-20T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2018-11-20T00:00:00&#43;00:00">
  

  

  

  <title>Day Two: Spatial data manipulation and visualisation in R | BES QUANTITATIVE ECOLOGY GROUP</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >

<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">BES QUANTITATIVE ECOLOGY GROUP</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#home">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            
            <span>About</span>
            
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/about/qesig/">
                
                <span>QE-SIG</span>
                
              </a>
            </li>
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/about/committee/">
                
                <span>Committee</span>
                
              </a>
            </li>
            
          </ul>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#events">
            
            <span>Events</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true">
            
            <span>Courses</span>
            
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            
            <li class="dropdown-item my-0 py-0 mx-0 px-0">
              <a href="/courses/advancingr/">
                
                <span>Advancing Your R</span>
                
              </a>
            </li>
            
          </ul>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      

        

        
      </ul>

    </div>
  </div>
</nav>



<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      




<form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-3" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <span><i class="fas fa-bars"></i></span>
  </button>

  
  <input name="q" type="search" class="form-control" id="search-query" placeholder="Search..." autocomplete="off">
  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/">Courses</a>

  </div>
  
  <div class="docs-toc-item">
    <a class="docs-toc-link" href="/courses/advancingr/">Advancing Your R</a>
    <ul class="nav docs-sidenav">
      
      <li >
        <a href="/courses/advancingr-tidyverse/">Day One: Data manipulation and Visualisation</a>
      </li>
      
      <li class="active">
        <a href="/courses/advancingr-spatial/">Day Two: Working with spatial data</a>
      </li>
      
    </ul>
    

  </div>
  
  
</nav>

    </div>

    
    <div class="d-none d-xl-block col-xl-2 docs-toc">
      
      <p class="docs-toc-title">On this page</p>
      

      <nav id="TableOfContents">
  <ul>
    <li><a href="#required-packages">Required packages</a></li>
    <li><a href="#what-is-a-spatial-object">What is a spatial object?</a></li>
  </ul>

  <ul>
    <li><a href="#modify-sf---sfc-objects">Modify sf - sfc objects</a>
      <ul>
        <li><a href="#lines">Lines</a></li>
        <li><a href="#polygon">Polygon</a></li>
        <li><a href="#intersects-and-intesections">Intersects and intesections</a></li>
        <li><a href="#circle-buffer-intersection">circle buffer intersection</a></li>
        <li><a href="#difference-between-objects">Difference between objects</a></li>
        <li><a href="#union-merge-and-melt-objects">Union (merge and melt) objects</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#raster-object">Raster object</a>
      <ul>
        <li><a href="#land-cover">Land cover</a></li>
        <li><a href="#spatial-extraction-raster-value-for-a-vector-object">Spatial extraction (raster value for a vector object)</a></li>
      </ul>
    </li>
    <li><a href="#vector-object">Vector object</a></li>
    <li><a href="#read-and-write-your-spatial-object-in-shapefile">Read and write your spatial object in Shapefile</a></li>
    <li><a href="#subseting-and-filtering">Subseting and filtering</a></li>
  </ul>

  <ul>
    <li><a href="#create-postgresql-database">Create PostgreSQL database</a></li>
    <li><a href="#send-spatial-data-to-your-newly-created-database-located-on-your-local-server">Send spatial data to your newly created database located on your local server</a></li>
    <li><a href="#interacting-with-postgresql-through-your-terminal">Interacting with PostgreSQL through your terminal</a></li>
    <li><a href="#some-more-raster-operations">Some more raster operations</a>
      <ul>
        <li><a href="#hillshade-and-terrain-map">Hillshade and Terrain map</a></li>
      </ul>
    </li>
  </ul>

  <ul>
    <li><a href="#adding-a-raster-to-a-ggplot">Adding a raster to a ggplot</a></li>
    <li><a href="#can-you-plot-the-deer-occurrence-extracted-from-gbif-on-a-uk-map">Can you plot the deer occurrence extracted from GBIF on a UK map?</a></li>
  </ul>
</nav>

      <ul class="nav toc-top">
        <li><a href="#">Back to top</a></li>
      </ul>

      
    </div>
    

    <main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role="main">
      <div id="search-hits">
        
      </div>
      <article class="article" itemscope itemtype="http://schema.org/Article">

        <div class="docs-article-container">
          <h1 itemprop="name">Day Two: Spatial data manipulation and visualisation in R</h1>
          
          <h2>Reto Schmucki</h2>
          
          <hr>
          <div class="article-style" itemprop="articleBody">
            <h1 id="part-i-preliminaries">Part I: Preliminaries</h1>
<h2 id="required-packages">Required packages</h2>
<p>For this &ldquo;tutorial&rdquo;, you will need some packages and their dependencies</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;raster&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;raster&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;sf&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;sf&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;ggplot2&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;ggplot2&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;ggspatial&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;ggspatial&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;rgdal&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;rgdal&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;RPostgreSQL&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;RPostgreSQL&#34;</span>)
<span style="color:#a6e22e">if</span>(<span style="color:#f92672">!</span><span style="color:#a6e22e">requireNamespace</span>(<span style="color:#e6db74">&#34;rgbif&#34;</span>)) <span style="color:#a6e22e">install.packages</span>(<span style="color:#e6db74">&#34;rgbif&#34;</span>)

<span style="color:#a6e22e">library</span>(raster)
<span style="color:#a6e22e">library</span>(sf)
<span style="color:#a6e22e">library</span>(ggplot2)
<span style="color:#a6e22e">library</span>(ggspatial)
<span style="color:#a6e22e">library</span>(RPostgreSQL)
<span style="color:#a6e22e">library</span>(rgdal)
<span style="color:#a6e22e">library</span>(rgbif)
</code></pre></div><p>The data for this tutorial are available from [here](needs link).</p>
<h2 id="what-is-a-spatial-object">What is a spatial object?</h2>
<p>A spatial object is an entity with coordinates in a geographical space (x, y) or (x, y, z) with a specific projection.</p>
<blockquote>
<p><strong>Coordinates are not enough!</strong> To illustrate this affirmation, just have a look at this example.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># create two ojbects with their long/lat coordinates</span>
point_liverpool <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Liverpool&#39;</span>, longitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">-2.98</span>, latitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">53.41</span>)
point_edinburgh <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Edinburgh&#39;</span>, longitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">-3.19</span>, latitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">55.95</span>)
city_points <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(point_liverpool, point_edinburgh)

<span style="color:#75715e"># Now have a look at them in a 2D space.</span>
<span style="color:#a6e22e">plot</span>(city_points[,<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>, <span style="color:#e6db74">&#34;latitude&#34;</span>)], pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;magenta&#39;</span>)
<span style="color:#a6e22e">text</span>(city_points[,<span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>, <span style="color:#e6db74">&#34;latitude&#34;</span>)], labels <span style="color:#f92672">=</span> city_points<span style="color:#f92672">$</span>name, pos <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>))
</code></pre></div><p>With these two cities, although the coordinates are right, you have no information about the context of their coordinates.</p>
<blockquote>
<p><em>Spatial projection</em>
The Coordinate Reference System or CRS of a spatial object tells R where the spatial object is located in geographic space (<em>see</em> <a href="http://spatialreference.org/)">http://spatialreference.org/)</a>.</p>
</blockquote>
<p>For example, you might have seen the expression WGS84, the common longitude-latitude (degree decimal), or maybe EPSG:4326.
In other words, spatial objects should come with some information relative to their reference system (CRS), no matter if it&rsquo;s a raster, a point, a line of a complex polygon. To locate an object in space, you need to know the reference system and the units in which the coordinates are expressed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Adding a projection to our cities, using WGS84</span>
proj_city_points <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(city_points, coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>, <span style="color:#e6db74">&#34;latitude&#34;</span>), crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">4326</span>)
<span style="color:#a6e22e">plot</span>(proj_city_points, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>)
<span style="color:#a6e22e">legend</span>(<span style="color:#e6db74">&#34;topleft&#34;</span>, legend <span style="color:#f92672">=</span> proj_city_points<span style="color:#f92672">$</span>name, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, bty<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;n&#34;</span>)

<span style="color:#75715e"># get some base layer to see this in perspective</span>
country_sf_gbr <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(raster<span style="color:#f92672">::</span><span style="color:#a6e22e">getData</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GADM&#34;</span>, country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GBR&#39;</span>, level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))

<span style="color:#75715e"># visualize the points on a map</span>
<span style="color:#a6e22e">plot</span>(country_sf_gbr<span style="color:#f92672">$</span>geometry, graticule <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wheat1&#34;</span>, xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-15</span>, <span style="color:#ae81ff">5</span>), ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">50</span>, <span style="color:#ae81ff">61</span>))
<span style="color:#a6e22e">plot</span>(proj_city_points, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">legend</span>(<span style="color:#e6db74">&#34;topleft&#34;</span>, legend <span style="color:#f92672">=</span> proj_city_points<span style="color:#f92672">$</span>name, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, bty<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;n&#34;</span>)
<span style="color:#a6e22e">text</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">-15</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">50.2</span>, <span style="color:#e6db74">&#34;EPSG:4326 - WGS84&#34;</span>, pos <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>)
</code></pre></div><p>The advantage of having a CRS is that you can transform your coordinates, so it is expressed to other reference system (i.e. on other origin and units).</p>
<blockquote>
<p><em>Changing Projection</em> (st_tranform)
Some projections more appropriate for representing specific geographic context. Why is their so many CRS?</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># Reproject your city points in OSGB 1936 / British National Grid (EPSG:27700)</span>
proj_city_points_osgb <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(proj_city_points, crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">27700</span>)
country_sf_gbr_osgb <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(country_sf_gbr, crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">27700</span>)

<span style="color:#75715e"># visualize the points on a map</span>
<span style="color:#a6e22e">dev.new</span>()
<span style="color:#a6e22e">plot</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>geometry, graticule <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wheat1&#34;</span>, xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-333585</span>, <span style="color:#ae81ff">713000</span>), ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">20000</span>, <span style="color:#ae81ff">1290000</span>))
<span style="color:#a6e22e">plot</span>(proj_city_points_osgb, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">legend</span>(<span style="color:#e6db74">&#34;topleft&#34;</span>, legend <span style="color:#f92672">=</span> proj_city_points_osgb<span style="color:#f92672">$</span>name, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>), pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, bty<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;n&#34;</span>)
<span style="color:#a6e22e">text</span>(x <span style="color:#f92672">=</span> <span style="color:#ae81ff">-453585</span>, y <span style="color:#f92672">=</span> <span style="color:#ae81ff">25000</span>, <span style="color:#e6db74">&#34;EPSG:27700 - OSGB 1936 &#34;</span>, pos <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.7</span>)
</code></pre></div><blockquote>
<p>to get coordinates on a plot, you can use the function drawExtent() from the raster package that allow you to clic on a map to get the coordinates of an extent.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">plot</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>geometry, graticule <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wheat1&#34;</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">drawExtent</span>()
</code></pre></div><h1 id="part-ii-building-and-working-with-spatial-objects-using-sf-in-r">PART II: Building and working with spatial objects using sf in R</h1>
<p>This is a revolution, providing a modern, stronger and cleaner workflow to deal with spatial object in R, at least vector data. The &ldquo;sf&rdquo; is developed by some of the same people that provide us with &ldquo;sp&rdquo;, offering an ecosystem that open new opportunities to do GIS in R. The firs place to look for resource is the sf package website <a href="https://r-spatial.github.io/sf/index.html">https://r-spatial.github.io/sf/index.html</a>, this a first stop to learn how it work and develop new skills in R.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(sf)

p1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_point</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>))
p2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_point</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>))
p3 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_multipoint</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#ae81ff">2</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">3</span>), ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, byrow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
p4 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(<span style="color:#a6e22e">data.frame</span>(X <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">7</span>), Y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>) ), coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;X&#34;</span>, <span style="color:#e6db74">&#34;Y&#34;</span>))
p5 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_sfc</span>(p1, p2, p3)

<span style="color:#a6e22e">plot</span>(p1)
<span style="color:#a6e22e">plot</span>(p3, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>)
<span style="color:#a6e22e">plot</span>(p2, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;magenta&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h2 id="modify-sf---sfc-objects">Modify sf - sfc objects</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">p6 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> <span style="color:#a6e22e">st_sfc</span>(p3), to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;POINT&#34;</span>)
p_multi <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_cast</span>(p6, ids <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>), group_or_plist <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MULTIPOINT&#34;</span>)

<span style="color:#a6e22e">plot</span>(p_multi[1], ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>), xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tomato3&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>)
<span style="color:#a6e22e">plot</span>(p_multi[2], col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;magenta&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

p7 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> p4, to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;POINT&#34;</span>)
p8 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(<span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> p4[1<span style="color:#f92672">:</span><span style="color:#ae81ff">3</span>,], to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MULTIPOINT&#34;</span>), p4[4,])
p8
</code></pre></div><h3 id="lines">Lines</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">l1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_linestring</span>(<span style="color:#a6e22e">matrix</span>(<span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>), ncol <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, byrow <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>))
lp <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_sfc</span>(l1), to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MULTIPOINT&#34;</span>)
bl1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(l1, <span style="color:#ae81ff">2</span>)
blp <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_sfc</span>(bl1), to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MULTIPOINT&#34;</span>)

<span style="color:#a6e22e">plot</span>(lp, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">10</span>), xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">plot</span>(blp, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;magenta&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(l1, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tomato3&#34;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h3 id="polygon">Polygon</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bl1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(l1, <span style="color:#ae81ff">2</span>)
blp <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_cast</span>(x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_sfc</span>(bl1), to <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;MULTIPOINT&#34;</span>)

<span style="color:#a6e22e">plot</span>(bl1, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lightblue&#34;</span>, border <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>)
<span style="color:#a6e22e">plot</span>(lp, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">10</span>), xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">10</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(blp, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;magenta&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(l1, col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tomato3&#34;</span>, lwd <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h3 id="intersects-and-intesections">Intersects and intesections</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">p1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(<span style="color:#a6e22e">data.frame</span>(X <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">7</span>), Y <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>) ), coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;X&#34;</span>, <span style="color:#e6db74">&#34;Y&#34;</span>), crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">4326</span>)
poly1 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">st_as_sfc</span>(<span style="color:#a6e22e">st_bbox</span>(<span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">2</span>)))
poly2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">st_as_sfc</span>(<span style="color:#a6e22e">st_bbox</span>(<span style="color:#a6e22e">st_buffer</span>(p1[3,], <span style="color:#ae81ff">1.5</span>)))

<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;goldenrod&#34;</span>, xlim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">-5</span>, <span style="color:#ae81ff">5</span>), ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>))
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly2), col <span style="color:#f92672">=</span> <span style="color:#a6e22e">rgb</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0.3</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(p1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;magenta&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex<span style="color:#f92672">=</span> <span style="color:#ae81ff">1.5</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e">## INTERSECTION</span>
poly3 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersection</span>(poly1, poly2)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly3), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lightblue&#34;</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e">## INTERSECT</span>
p1_poly1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersects</span>(p1, poly1, sparse <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(p1[p1_poly1,]), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;turquoise&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, cex <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h3 id="circle-buffer-intersection">circle buffer intersection</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">poly1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">2</span>)
poly2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[3,], <span style="color:#ae81ff">1.5</span>)
int_b2_b1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersection</span>(poly2, poly1)

<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly1), col <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>, border <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;red&#34;</span>, ylim <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7</span>), axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly2), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(p1[2,]), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(p1[3,]), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(int_b2_b1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lightblue&#34;</span>, boder <span style="color:#f92672">=</span> <span style="color:#66d9ef">NA</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h3 id="difference-between-objects">Difference between objects</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">poly1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">2</span>)
poly2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">4</span>)
dif_poly2_poly1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_difference</span>(poly2, poly1)

<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(dif_poly2_poly1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;orange&#34;</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;blue&#34;</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h3 id="union-merge-and-melt-objects">Union (merge and melt) objects</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">poly1 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">2</span>)
poly2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(p1[2,], <span style="color:#ae81ff">4</span>)
uni_poly1_2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_union</span>(dif_poly2_poly1, poly1)

<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(uni_poly1_2), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;lightblue&#34;</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(poly1), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;tomato3&#34;</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(<span style="color:#a6e22e">st_buffer</span>(poly1,<span style="color:#ae81ff">-1</span>)), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">plot</span>(<span style="color:#a6e22e">st_geometry</span>(<span style="color:#a6e22e">st_centroid</span>(poly1)), col <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, pch <span style="color:#f92672">=</span> <span style="color:#ae81ff">19</span>, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><p>If you like it tidy and the dplyr way? Since sf is essentally a data.frame with  a list of spatial attribute attached, it works well in the tidy univers. Have a look at this blog to get a first feel <a href="http://strimas.com/r/tidy-sf/">http://strimas.com/r/tidy-sf/</a>.</p>
<h1 id="part-iii-load-and-manipulate-spatial-objects">PART III: Load and manipulate spatial objects</h1>
<p>Spatial data are increasingly available from the Web, from species occurrence to natural and cultural features data, accessing spatial data is now relatively easy. For base layers, you can find many freely available data sets such as the ones provided by the Natural Earth [http://www.naturalearthdata.com], the IUCN Protected Planet database [www.protectedplanet.net], the GADM project [https://gadm.org], worldclim [http://worldclim.org/version2] the CHELSA climate data sets [http://chelsa-climate.org] or the European Environmental Agency [https://www.eea.europa.eu/data-and-maps/data#c0=5&amp;c11=&amp;c5=all&amp;b_start=0]</p>
<h2 id="raster-object">Raster object</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(raster)
<span style="color:#75715e"># annual mean temperature</span>
chelsa_amt <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">raster</span>(<span style="color:#e6db74">&#34;data/CHELSA_bio10_1.tif&#34;</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(chelsa_amt)
chelsa_amt

<span style="color:#75715e"># crop climate data for a specific bounding box</span>
chelsa_amt_gbr <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">crop</span>(chelsa_amt, raster<span style="color:#f92672">::</span><span style="color:#a6e22e">extent</span>(country_sf_gbr)) <span style="color:#75715e"># cut the worldwide raster according to</span>
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(chelsa_amt_gbr)

<span style="color:#75715e"># convert temperature data in usual unit</span>
chelsa_amt_gbr[] <span style="color:#f92672">&lt;-</span> chelsa_amt_gbr[]<span style="color:#f92672">*</span><span style="color:#ae81ff">0.1</span> <span style="color:#75715e"># convert temperature data in usual unit</span>
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">res</span>(chelsa_amt_gbr)

<span style="color:#75715e"># change resolution aggregate() or disaggregate()</span>
chelsa_amt_gbr_2 <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">disaggregate</span>(chelsa_amt_gbr, fact<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">res</span>(chelsa_amt_gbr_2)

chelsa_amt_gbr_3 <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">aggregate</span>(chelsa_amt_gbr, fact<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">res</span>(chelsa_amt_gbr_3)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(chelsa_amt_gbr_3)
</code></pre></div><blockquote>
<p><em>Other format for gridded data</em>
netCDF format is commonly used for gridded time series (temperature)</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">rast_1 <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">raster</span>(<span style="color:#e6db74">&#34;data/tg_0.25deg_reg_2011-2017_v17.0.nc&#34;</span>, band <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
rast_2 <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">raster</span>(<span style="color:#e6db74">&#34;data/tg_0.25deg_reg_2011-2017_v17.0.nc&#34;</span>, band <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>)
rast_stack <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">stack</span>(rast_1, rast_2)
<span style="color:#a6e22e">plot</span>(rast_stack<span style="color:#f92672">$</span>mean.temperature.1)
<span style="color:#a6e22e">plot</span>(rast_stack)
</code></pre></div><h3 id="land-cover">Land cover</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">eunis_1km <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">raster</span>(<span style="color:#e6db74">&#34;data/es_l1_1km.tif&#34;</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(eunis_1km)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">projection</span>(eunis_1km)
</code></pre></div><h3 id="spatial-extraction-raster-value-for-a-vector-object">Spatial extraction (raster value for a vector object)</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">proj_city_points_laea <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(proj_city_points, raster<span style="color:#f92672">::</span><span style="color:#a6e22e">projection</span>(eunis_1km))
eunis_city <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">extract</span>(eunis_1km, <span style="color:#a6e22e">as</span>(proj_city_points_laea, <span style="color:#e6db74">&#34;Spatial&#34;</span>))
eunis_city <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">extract</span>(eunis_1km, <span style="color:#a6e22e">as</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_buffer</span>(proj_city_points_laea, <span style="color:#ae81ff">10000</span>), <span style="color:#e6db74">&#34;Spatial&#34;</span>))

<span style="color:#a6e22e">str</span>(eunis_city)
<span style="color:#a6e22e">table</span>(eunis_city[[1]])

proportion <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">table</span>(eunis_city[[1]]))<span style="color:#a6e22e">[which</span>(<span style="color:#a6e22e">names</span>(<span style="color:#a6e22e">table</span>(eunis_city[[1]]))<span style="color:#f92672">!=</span><span style="color:#e6db74">&#34;10&#34;</span>)] <span style="color:#f92672">/</span> <span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">table</span>(eunis_city[[1]]))) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
proportion
</code></pre></div><h2 id="vector-object">Vector object</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(sf)
st_prov <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_read</span>(<span style="color:#e6db74">&#34;data/GADM_2.8_GBR_adm2.shp&#34;</span>)
<span style="color:#a6e22e">plot</span>(st_prov[,<span style="color:#e6db74">&#34;HASC_2&#34;</span>], graticule <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e"># Older option</span>
<span style="color:#a6e22e">library</span>(rgdal)
st_prov_sp <span style="color:#f92672">&lt;-</span> rgdal<span style="color:#f92672">::</span><span style="color:#a6e22e">readOGR</span>(<span style="color:#e6db74">&#34;data&#34;</span>, <span style="color:#e6db74">&#34;GADM_2.8_GBR_adm2&#34;</span>)
<span style="color:#a6e22e">class</span>(st_prov_sp)
<span style="color:#a6e22e">plot</span>(st_prov_sp, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e"># Change projection of an &#34;sp&#34; object</span>
crs.osgb <span style="color:#f92672">=</span> <span style="color:#a6e22e">CRS</span>(<span style="color:#e6db74">&#34;+init=epsg:27700&#34;</span>)
st_prov_sp.osgb <span style="color:#f92672">=</span> sp<span style="color:#f92672">::</span><span style="color:#a6e22e">spTransform</span>(st_prov_sp, crs.osgb)
<span style="color:#a6e22e">plot</span>(st_prov_sp.osgb, axes <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#a6e22e">spplot</span>(st_prov_sp.osgb, <span style="color:#e6db74">&#34;HASC_2&#34;</span>, colorkey <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
</code></pre></div><h2 id="read-and-write-your-spatial-object-in-shapefile">Read and write your spatial object in Shapefile</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#75715e"># read with &#34;sf&#34;</span>
st_prov <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_read</span>(<span style="color:#e6db74">&#34;data/GADM_2.8_GBR_adm2.shp&#34;</span>)

<span style="color:#75715e"># write with &#34;sf&#34;</span>
sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_write</span>(st_prov, dsn <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;st_prov.shp&#34;</span>, delete_layer <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e"># write with OGR (rgdal)</span>
st_prov_sp <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">as</span>(st_prov, <span style="color:#e6db74">&#34;Spatial&#34;</span>)
rgdal<span style="color:#f92672">::</span><span style="color:#a6e22e">writeOGR</span>(st_prov_sp, <span style="color:#e6db74">&#34;st_prov_sp&#34;</span>, driver <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ESRI Shapefile&#34;</span>)
</code></pre></div><h2 id="subseting-and-filtering">Subseting and filtering</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wdpa_gbr <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_read</span>(<span style="color:#e6db74">&#34;data/wdpa_gbr.shp&#34;</span>)
wdpa_gbr <span style="color:#f92672">&lt;-</span> wdpa_gbr[wdpa_gbr<span style="color:#f92672">$</span>MARINE <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>,]
<span style="color:#a6e22e">plot</span>(wdpa_gbr<span style="color:#f92672">$</span>geometry)

<span style="color:#75715e">## bounding box</span>
bb <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_bbox</span>(country_sf_gbr)
bb

<span style="color:#75715e">## faster solution</span>
bb_poly <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_make_grid</span>(country_sf_gbr, n <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>)
wdpa_gbr_2 <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_intersects</span>(wdpa_gbr, bb_poly, sparse <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
wdpa_gbr <span style="color:#f92672">&lt;-</span> wdpa_gbr[wdpa_gbr_2,]
<span style="color:#a6e22e">plot</span>(wdpa_gbr<span style="color:#f92672">$</span>geometry[wdpa_gbr<span style="color:#f92672">$</span>IUCN_CAT <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;V&#34;</span>])

wdpa_cntr <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(wdpa_gbr)
<span style="color:#a6e22e">plot</span>(wdpa_cntr<span style="color:#f92672">$</span>geometry)

<span style="color:#75715e">## building a box from the st_bbox output</span>
g.bbox <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">extent</span>(<span style="color:#a6e22e">as.numeric</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_bbox</span>(country_sf_gbr))<span style="color:#a6e22e">[c</span>(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">4</span>)])
g.bbox_sf <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_set_crs</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sfc</span>(<span style="color:#a6e22e">as</span>(g.bbox, <span style="color:#e6db74">&#39;SpatialPolygons&#39;</span>)), <span style="color:#ae81ff">3035</span>)
<span style="color:#a6e22e">plot</span>(g.bbox_sf, add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><blockquote>
<p><em>Try it your self</em>
Get some river data from
<a href="http://land.copernicus.eu/pan-european/satellite-derived-products/eu-hydro/eu-hydro-public-beta/eu-hydro-river-network/view">http://land.copernicus.eu/pan-european/satellite-derived-products/eu-hydro/eu-hydro-public-beta/eu-hydro-river-network/view</a></p>
</blockquote>
<h1 id="part-iv-interfacing-r-and-posgresqlpostgis">PART IV: Interfacing R and PosgreSQL/PostGIS</h1>
<ol>
<li>Install PostgreSQL, with the PostGIS extension</li>
<li>Create a database</li>
<li>Populate your database</li>
<li>Extract from your database</li>
</ol>
<h2 id="create-postgresql-database">Create PostgreSQL database</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(<span style="color:#e6db74">&#39;RPostgreSQL&#39;</span>)

<span style="color:#75715e"># create a new database in on your local PostgreSQL server</span>
sql_createdb <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;-h localhost -U &#34;</span>, <span style="color:#e6db74">&#34;postgres&#34;</span>, <span style="color:#e6db74">&#34; -T &#34;</span>, <span style="color:#e6db74">&#34;postgis_22_sample&#34;</span>, <span style="color:#e6db74">&#34; -E UTF8 -O postgres &#34;</span>, <span style="color:#e6db74">&#34;RGIS_workshop&#34;</span>)
<span style="color:#a6e22e">system2</span>(<span style="color:#e6db74">&#34;createdb&#34;</span>, sql_createdb, invisible <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)

<span style="color:#75715e"># connect R to your server and newly created database</span>
drv <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dbDriver</span>(<span style="color:#e6db74">&#34;PostgreSQL&#34;</span>)
dbcon <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dbConnect</span>(drv, dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RGIS_workshop&#34;</span>,
                 host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>, port <span style="color:#f92672">=</span> <span style="color:#ae81ff">5432</span>,
                 user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;postgres&#34;</span>, password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;****&#34;</span>)

<span style="color:#75715e"># create a schema, send your first SQL statement (query)</span>
sql_createschema <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;CREATE SCHEMA IF NOT EXISTS my_shemas AUTHORIZATION postgres;&#34;</span>)
<span style="color:#a6e22e">dbSendStatement</span>(dbcon, sql_createschema)

<span style="color:#75715e"># have a look at your PostgreSQL database, using pgAdmin</span>
</code></pre></div><h2 id="send-spatial-data-to-your-newly-created-database-located-on-your-local-server">Send spatial data to your newly created database located on your local server</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(sf)
dbcon <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dbConnect</span>(drv, dbname <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;RGIS_workshop&#34;</span>,
                 host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>, port <span style="color:#f92672">=</span> <span style="color:#ae81ff">5432</span>,
                 user <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;postgres&#34;</span>, password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*****&#34;</span>)

wdpa_gbr <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_read</span>(<span style="color:#e6db74">&#34;data/wdpa_gbr.shp&#34;</span>)
sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_write</span>(wdpa_gbr, dbcon, overwrite <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)

<span style="color:#75715e"># check if you succeeded</span>
<span style="color:#a6e22e">dbExistsTable</span>(dbcon, <span style="color:#e6db74">&#34;wdpa_gbr&#34;</span>)

<span style="color:#75715e"># extract some data with a SQL query and a condition</span>
psql_extract <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">dbGetQuery</span>(dbcon, <span style="color:#e6db74">&#34;SELECT \&#34;IUCN_CAT\&#34;, ST_AsText(geometry) as geom FROM wdpa_gbr WHERE \&#34;IUCN_CAT\&#34; = \&#39;V\&#39; AND \&#34;MARINE\&#34; = \&#39;0\&#39;&#34;</span>)

<span style="color:#a6e22e">str</span>(psql_extract)
new_extract <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(psql_extract, wkt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;geom&#34;</span>)
new_extract <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_set_crs</span>(new_extract, <span style="color:#ae81ff">4326</span>)
<span style="color:#a6e22e">plot</span>(new_extract)

new_area <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_area</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(new_extract, <span style="color:#ae81ff">27700</span>))
<span style="color:#a6e22e">head</span>(new_area)
</code></pre></div><h2 id="interacting-with-postgresql-through-your-terminal">Interacting with PostgreSQL through your terminal</h2>
<blockquote>
<p><em>In your terminal, type</em>
ogr2ogr -f &ldquo;PostgreSQL&rdquo; -t_srs EPSG:27700 PG:&ldquo;host=localhost port=5432 dbname=RGIS_workshop user=postgres password=****&rdquo; &lsquo;C:\Users\retoschm\OneDrive - Natural Environment Research Council\Rgis_workshop\data\GADM_2.8_GBR_adm2.shp&rsquo; -nln public.wdpa_gbr2 -nlt MULTIPOLYGON -overwrite -progress -unsetFid &ndash;config PG_USE_COPY YES</p>
</blockquote>
<h2 id="some-more-raster-operations">Some more raster operations</h2>
<h3 id="hillshade-and-terrain-map">Hillshade and Terrain map</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(raster)
alt <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">getData</span>(<span style="color:#e6db74">&#34;alt&#34;</span>, country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GBR&#34;</span>)
slope <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">terrain</span>(alt, opt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;slope&#34;</span>)
aspect <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">terrain</span>(alt, opt <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;aspect&#34;</span>)
hill <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">hillShade</span>(slope, aspect, angle <span style="color:#f92672">=</span> <span style="color:#ae81ff">40</span>, direction <span style="color:#f92672">=</span> <span style="color:#ae81ff">270</span>)

<span style="color:#75715e"># plot your raster and newly extracted polygons on a map</span>
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(hill, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">grey</span>(<span style="color:#ae81ff">0</span><span style="color:#f92672">:</span><span style="color:#ae81ff">100</span><span style="color:#f92672">/</span><span style="color:#ae81ff">100</span>), legend <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>)
<span style="color:#a6e22e">plot</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(new_extract, <span style="color:#ae81ff">4326</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
raster<span style="color:#f92672">::</span><span style="color:#a6e22e">plot</span>(alt, col <span style="color:#f92672">=</span> <span style="color:#a6e22e">terrain.colors</span>(<span style="color:#ae81ff">25</span>, alpha <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>), add <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
</code></pre></div><h1 id="part-v-plot-your-spatial-object-data-with-ggplot2">PART V: Plot your spatial object data with ggplot2</h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(ggplot2)
<span style="color:#a6e22e">library</span>(ggspatial)

country_sf_gbr <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(raster<span style="color:#f92672">::</span><span style="color:#a6e22e">getData</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GADM&#34;</span>, country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GBR&#39;</span>, level <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>))
country_sf_gbr_osgb <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(country_sf_gbr, crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">27700</span>)

point_liverpool <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Liverpool&#39;</span>, longitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">-2.98</span>, latitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">53.41</span>)
point_edinburgh <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">data.frame</span>(name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Edinburgh&#39;</span>, longitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">-3.19</span>, latitude <span style="color:#f92672">=</span> <span style="color:#ae81ff">55.95</span>)
city_points <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">rbind</span>(point_liverpool, point_edinburgh)
proj_city_points_osgb <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_transform</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(city_points, coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;longitude&#34;</span>, <span style="color:#e6db74">&#34;latitude&#34;</span>), crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">4326</span>), crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">27700</span>)

<span style="color:#75715e">## simple plot with ggplot</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>))

<span style="color:#75715e">## some colors</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>(color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>, fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;wheat1&#34;</span> ) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>))

<span style="color:#75715e">## color with some qualitative meaning</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>(<span style="color:#a6e22e">aes</span>(fill <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_area</span>(country_sf_gbr_osgb)))) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">scale_fill_viridis_c</span>(option <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;plasma&#34;</span>, name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Area&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>))

<span style="color:#75715e"># add a scale bar and a north arrow</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_scale</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, width_hint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_north_arrow</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, which_north <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>,
          pad_x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.75</span>, <span style="color:#e6db74">&#34;in&#34;</span>), pad_y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;in&#34;</span>),
          style <span style="color:#f92672">=</span> north_arrow_fancy_orienteering) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>))

<span style="color:#75715e"># add more spatial object with geom_sf</span>
<span style="color:#a6e22e">ggplot</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>(data <span style="color:#f92672">=</span> proj_city_points_osgb, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, color <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotate</span>(geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>,
            x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">1</span>],
            y <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">2</span>],
            label <span style="color:#f92672">=</span> country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1,
        fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;italic&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;grey22&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>)  <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_scale</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, width_hint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_north_arrow</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, which_north <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>,
          pad_x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.75</span>, <span style="color:#e6db74">&#34;in&#34;</span>), pad_y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;in&#34;</span>),
          style <span style="color:#f92672">=</span> north_arrow_fancy_orienteering) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>))
</code></pre></div><h2 id="adding-a-raster-to-a-ggplot">Adding a raster to a ggplot</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(raster)
alt <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">getData</span>(<span style="color:#e6db74">&#34;alt&#34;</span>, country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GBR&#34;</span>)
<span style="color:#75715e"># need to reproject your raster to match the other layer and get a regular resolution</span>
alt_prj <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">projectRaster</span>(alt, crs <span style="color:#f92672">=</span> sp<span style="color:#f92672">::</span><span style="color:#a6e22e">CRS</span>(<span style="color:#e6db74">&#34;+init=epsg:27700&#34;</span>), res <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>)

<span style="color:#75715e"># first method</span>
alt_prj_df <span style="color:#f92672">&lt;-</span> raster<span style="color:#f92672">::</span><span style="color:#a6e22e">as.data.frame</span>(alt_prj, xy <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>)
<span style="color:#a6e22e">colnames</span>(alt_prj_df)  <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>, <span style="color:#e6db74">&#34;Altitude&#34;</span>)

<span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_tile</span>(data <span style="color:#f92672">=</span> alt_prj_df, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, fill <span style="color:#f92672">=</span> Altitude)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotate</span>(geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>,
            x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">1</span>],
            y <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">2</span>],
            label <span style="color:#f92672">=</span> country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1,
        fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;italic&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_scale</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, width_hint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_north_arrow</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, which_north <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>,
          pad_x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.75</span>, <span style="color:#e6db74">&#34;in&#34;</span>), pad_y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;in&#34;</span>),
          style <span style="color:#f92672">=</span> north_arrow_fancy_orienteering) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">theme</span>(panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;aliceblue&#34;</span>))

<span style="color:#75715e">## second method (better)</span>
alt_prj_spdf <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as</span>(alt_prj, <span style="color:#e6db74">&#34;SpatialPixelsDataFrame&#34;</span>)
alt_prj_df2 <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.data.frame</span>(alt_prj_spdf)
<span style="color:#a6e22e">colnames</span>(alt_prj_df2) <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;Altitude&#34;</span>, <span style="color:#e6db74">&#34;x&#34;</span>, <span style="color:#e6db74">&#34;y&#34;</span>)

<span style="color:#a6e22e">ggplot</span>() <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>(data <span style="color:#f92672">=</span> country_sf_gbr_osgb) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_tile</span>(data <span style="color:#f92672">=</span> alt_prj_df2, <span style="color:#a6e22e">aes</span>(x <span style="color:#f92672">=</span> x, y <span style="color:#f92672">=</span> y, fill <span style="color:#f92672">=</span> Altitude)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">geom_sf</span>(data <span style="color:#f92672">=</span> proj_city_points_osgb, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>, color <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;magenta&#34;</span>, <span style="color:#e6db74">&#34;blue&#34;</span>)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">xlab</span>(<span style="color:#e6db74">&#34;Longitude&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">ylab</span>(<span style="color:#e6db74">&#34;Latitude&#34;</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotate</span>(geom <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;text&#34;</span>,
            x <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">1</span>],
            y <span style="color:#f92672">=</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_coordinates</span>(sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_centroid</span>(country_sf_gbr_osgb))[,<span style="color:#ae81ff">2</span>],
            label <span style="color:#f92672">=</span> country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1,
        fontface <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;italic&#34;</span>, color <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;white&#34;</span>, size <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_scale</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>, width_hint <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">annotation_north_arrow</span>(location <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bl&#34;</span>,which_north <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;true&#34;</span>,
          pad_x <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.75</span>, <span style="color:#e6db74">&#34;in&#34;</span>), pad_y <span style="color:#f92672">=</span> <span style="color:#a6e22e">unit</span>(<span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#34;in&#34;</span>),
          style <span style="color:#f92672">=</span> north_arrow_fancy_orienteering) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">ggtitle</span>(<span style="color:#e6db74">&#34;GBR map&#34;</span>, subtitle <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(<span style="color:#e6db74">&#34;(&#34;</span>, <span style="color:#a6e22e">length</span>(<span style="color:#a6e22e">unique</span>(country_sf_gbr_osgb<span style="color:#f92672">$</span>NAME_1)), <span style="color:#e6db74">&#34; countries)&#34;</span>)) <span style="color:#f92672">+</span>
    <span style="color:#a6e22e">theme</span>(panel.background <span style="color:#f92672">=</span> <span style="color:#a6e22e">element_rect</span>(fill <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;aliceblue&#34;</span>))
</code></pre></div><h2 id="can-you-plot-the-deer-occurrence-extracted-from-gbif-on-a-uk-map">Can you plot the deer occurrence extracted from GBIF on a UK map?</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">library</span>(rgbif)
deer_locations <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">occ_search</span>(scientificName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Cervus elaphus&#34;</span>, limit <span style="color:#f92672">=</span> <span style="color:#ae81ff">5000</span>,
                             hasCoordinate <span style="color:#f92672">=</span> <span style="color:#66d9ef">TRUE</span>, country <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;GB&#34;</span>,
                             return <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;data&#34;</span>) <span style="color:#f92672">%&gt;%</span> dplyr<span style="color:#f92672">::</span><span style="color:#a6e22e">select</span>(key, name, decimalLongitude,
		                         decimalLatitude, year, individualCount, datasetKey, country)

deer_locations_sf <span style="color:#f92672">&lt;-</span> sf<span style="color:#f92672">::</span><span style="color:#a6e22e">st_as_sf</span>(deer_locations, coords <span style="color:#f92672">=</span> <span style="color:#a6e22e">c</span>(<span style="color:#e6db74">&#34;decimalLongitude&#34;</span>, <span style="color:#e6db74">&#34;decimalLatitude&#34;</span>), crs <span style="color:#f92672">=</span> <span style="color:#ae81ff">4326</span>)
<span style="color:#a6e22e">plot</span>(deer_locations_sf[, <span style="color:#e6db74">&#34;datasetKey&#34;</span>])
<span style="color:#75715e"># ============</span>
<span style="color:#75715e"># YOUR TURN!</span>
<span style="color:#75715e"># ===========</span>
</code></pre></div><h1 id="your-challenge-build-some-wider-map-for-europe">Your challenge, build some wider map for Europe</h1>
<p>Have a look at tutorial 1, 2 and 3 on how to draw beautiful map with sf.</p>
<ol>
<li><a href="https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html">https://www.r-spatial.org/r/2018/10/25/ggplot2-sf.html</a></li>
<li><a href="https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-2.html">https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-2.html</a></li>
<li><a href="https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-3.html">https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-3.html</a></li>
</ol>
<p>Look at the exellent sf vignettes (<em>see list here</em>: <a href="https://cran.r-project.org/web/packages/sf/index.html">https://cran.r-project.org/web/packages/sf/index.html</a>)</p>

          </div>

          

        </div>

        <div class="body-footer">
          Last updated on Nov 20, 2018
        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    © 2021 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
  </p>
</footer>


    </main>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    <script src="/js/hugo-academic.js"></script>
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "Search Results",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js" integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    <script src="/js/search.js"></script>
    

    
    

  </body>
</html>


